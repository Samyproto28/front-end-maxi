import{C as Q,f as d,b as x,q as W,g as X,c as y,i as n,a as t,d as S,k as P,e as D,w as o,u as i,F as Y,j as Z,o as c,t as r,B as V}from"./index-CBeB2GAs.js";import{_ as aa,A as E,a as ta}from"./api-DDywFk_F.js";import{_ as f,a as ea}from"./AppCard-Cj7gG7Gi.js";import{_ as sa}from"./AppSelect-Bi8RopyZ.js";import{u as oa,A as R}from"./resultadoStore-BvQc6XBY.js";import{a as B,f as T}from"./formatters-vTMZW8fP.js";import{C as A}from"./constants-CfR4GbsR.js";import{i as ra}from"./importExportService-DzuBXo3j.js";const na={class:"min-h-screen flex flex-col"},la={class:"flex-1"},ia={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6"},ca={class:"mb-6"},da={class:"flex items-center justify-between"},ua={class:"max-w-md"},ma={key:0,class:"flex justify-center items-center py-12"},pa={class:"text-center py-8"},va={class:"mt-2 text-sm text-gray-500"},fa={class:"text-2xl"},ga={class:"font-medium"},ha={key:0,class:"text-xs text-gray-500"},_a={class:"font-mono"},xa={class:"flex items-center gap-2"},ya={class:"flex-1 bg-gray-200 rounded-full h-2 max-w-24"},ba={class:"text-sm font-mono w-16 text-right"},ka={class:"font-mono"},wa={class:"font-medium"},ja={class:"font-mono"},Ca={class:"flex items-center gap-2"},Sa={class:"flex-1 bg-gray-200 rounded-full h-2 max-w-24"},Pa={class:"text-sm font-mono w-16 text-right"},Va={class:"flex items-center gap-2"},Ba={class:"flex-1 bg-gray-200 rounded-full h-2 max-w-24"},Na={class:"text-sm font-mono w-16 text-right"},Oa={__name:"ResultadosNacional",setup(Ma){const z=Z(),b=oa(),{resultadoNacional:u,loading:$,error:N}=Q(b),m=d(A.DIPUTADOS),k=d(!1),g=d("votos"),w=d("desc"),j=d("provincia"),h=d("asc"),L=x(()=>Object.entries(A).map(([s,e])=>({value:e,label:s.charAt(0)+s.slice(1).toLowerCase()}))),C=x(()=>u.value&&(u.value.listas?.length>0||u.value.provincias?.length>0)),O=[{key:"posicion",label:"PosiciÃ³n",align:"center"},{key:"lista",label:"Lista",align:"left"},{key:"votos",label:"Votos Totales",align:"right",sortable:!0},{key:"porcentaje",label:"Porcentaje",align:"right",sortable:!0},{key:"provinciasGanadas",label:"Provincias Ganadas",align:"center",sortable:!0}],G=[{key:"provincia",label:"Provincia",align:"left",sortable:!0},{key:"mesasTotales",label:"Mesas Totales",align:"right",sortable:!0},{key:"escrutadasPorcentaje",label:"Escrutadas (%)",align:"right",sortable:!0},{key:"participacionPorcentaje",label:"ParticipaciÃ³n (%)",align:"right",sortable:!0}],F=x(()=>[...u.value?.listas||[]].sort((a,p)=>{const v=a[g.value]||0,l=p[g.value]||0;return w.value==="desc"?l-v:v-l}).map((a,p)=>({posicion:p+1,lista_id:a.id,nombre:a.nombre,alianza:a.alianza,votos:a.votos||0,porcentaje:a.porcentaje||0,provinciasGanadas:a.provincias_ganadas||0}))),U=x(()=>[...(u.value?.provincias||[]).map(a=>({id:a.id,provincia:a.nombre,mesasTotales:a.mesas_totales||0,mesasEscrutadas:a.mesas_escrutadas||0,escrutadasPorcentaje:a.mesas_totales>0?a.mesas_escrutadas/a.mesas_totales*100:0,participacionPorcentaje:a.electores>0?a.votos_emitidos/a.electores*100:0}))].sort((a,p)=>{const v=j.value,l=a[v],_=p[v];return typeof l=="string"?h.value==="desc"?_.localeCompare(l):l.localeCompare(_):h.value==="desc"?_-l:l-_})),q=()=>{z.push("/")},M=async()=>{try{await b.fetchResultadoNacional()}catch(s){console.error("Error loading national results:",s)}},H=s=>({1:"ðŸ¥‡",2:"ðŸ¥ˆ",3:"ðŸ¥‰"})[s]||s.toString(),I=({key:s,order:e})=>{g.value=s,w.value=e},J=({key:s,order:e})=>{j.value=s,h.value=e},K=async()=>{if(C.value){k.value=!0;try{const s=`resultados-nacional-${m.value.toLowerCase()}.csv`;await ra.exportNacionalAndDownload(s,{cargo:m.value})}catch(s){console.error("Error exporting results:",s)}finally{k.value=!1}}};return W(m,async s=>{s&&await b.setCargo(s)}),X(async()=>{await M()}),(s,e)=>(c(),y("div",na,[n(aa),t("main",la,[t("div",ia,[t("div",ca,[t("button",{onClick:q,class:"inline-flex items-center text-primary hover:text-primary-dark transition-colors mb-4"},[...e[1]||(e[1]=[t("svg",{class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1),P(" Volver al Dashboard ",-1)])]),t("div",da,[e[4]||(e[4]=t("h1",{class:"text-3xl font-bold text-gray-900"},"Resultados Nacionales",-1)),C.value?(c(),S(E,{key:0,variant:"secondary",loading:k.value,onClick:K},{"icon-left":o(()=>[...e[2]||(e[2]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1)])]),default:o(()=>[e[3]||(e[3]=P(" Exportar CSV ",-1))]),_:1},8,["loading"])):D("",!0)])]),n(f,{class:"mb-6"},{default:o(()=>[t("div",ua,[n(sa,{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=a=>m.value=a),options:L.value,label:"Cargo",placeholder:"Seleccionar cargo..."},null,8,["modelValue","options"])])]),_:1}),i($)?(c(),y("div",ma,[n(ta,{size:"lg"})])):i(N)?(c(),S(f,{key:1,class:"mb-6"},{default:o(()=>[t("div",pa,[e[6]||(e[6]=t("svg",{class:"mx-auto h-12 w-12 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),e[7]||(e[7]=t("h3",{class:"mt-4 text-lg font-medium text-gray-900"},"Error al cargar resultados",-1)),t("p",va,r(i(N).message),1),n(E,{variant:"primary",class:"mt-4",onClick:M},{default:o(()=>[...e[5]||(e[5]=[P(" Reintentar ",-1)])]),_:1})])]),_:1})):C.value?(c(),y(Y,{key:3},[n(f,{title:"Ranking Nacional de Listas",class:"mb-6"},{default:o(()=>[n(R,{columns:O,data:F.value,"sort-by":g.value,"sort-order":w.value,onSort:I},{"cell-posicion":o(({value:a})=>[t("span",fa,r(H(a)),1)]),"cell-lista":o(({row:a})=>[t("div",null,[t("div",ga,r(a.nombre),1),a.alianza?(c(),y("div",ha,r(a.alianza),1)):D("",!0)])]),"cell-votos":o(({value:a})=>[t("span",_a,r(i(T)(a)),1)]),"cell-porcentaje":o(({value:a})=>[t("div",xa,[t("div",ya,[t("div",{class:"bg-primary h-2 rounded-full transition-all",style:V({width:`${Math.min(a,100)}%`})},null,4)]),t("span",ba,r(i(B)(a)),1)])]),"cell-provinciasGanadas":o(({value:a})=>[t("span",ka,r(a),1)]),_:1},8,["data","sort-by","sort-order"])]),_:1}),n(f,{title:"ParticipaciÃ³n por Provincia"},{default:o(()=>[n(R,{columns:G,data:U.value,"sort-by":j.value,"sort-order":h.value,onSort:J},{"cell-provincia":o(({value:a})=>[t("span",wa,r(a),1)]),"cell-mesasTotales":o(({value:a})=>[t("span",ja,r(i(T)(a)),1)]),"cell-escrutadasPorcentaje":o(({value:a})=>[t("div",Ca,[t("div",Sa,[t("div",{class:"bg-green-500 h-2 rounded-full transition-all",style:V({width:`${Math.min(a,100)}%`})},null,4)]),t("span",Pa,r(i(B)(a)),1)])]),"cell-participacionPorcentaje":o(({value:a})=>[t("div",Va,[t("div",Ba,[t("div",{class:"bg-blue-500 h-2 rounded-full transition-all",style:V({width:`${Math.min(a,100)}%`})},null,4)]),t("span",Na,r(i(B)(a)),1)])]),_:1},8,["data","sort-by","sort-order"])]),_:1})],64)):(c(),S(f,{key:2,class:"mb-6"},{default:o(()=>[...e[8]||(e[8]=[t("div",{class:"text-center py-8"},[t("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})]),t("h3",{class:"mt-4 text-lg font-medium text-gray-900"},"Sin resultados"),t("p",{class:"mt-2 text-sm text-gray-500"},"No hay datos disponibles para el cargo seleccionado.")],-1)])]),_:1}))])]),n(ea)]))}};export{Oa as default};
