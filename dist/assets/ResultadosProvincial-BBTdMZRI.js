import{m as J,f as $,b as _,c as V,o as m,i as d,w as n,a as t,t as r,u as l,B as K,e as I,_ as Q,C as N,q as z,g as W,d as P,k as R,F as X,j as Y}from"./index-CBeB2GAs.js";import{_ as Z,A as O,a as tt}from"./api-DDywFk_F.js";import{_ as g,a as et}from"./AppCard-Cj7gG7Gi.js";import{_ as U}from"./AppSelect-Bi8RopyZ.js";import{A as st,u as ot}from"./resultadoStore-BvQc6XBY.js";import{_ as at,u as rt}from"./AppBadge-Bw8j-ABu.js";import{f,a as h}from"./formatters-vTMZW8fP.js";import{C as F}from"./constants-CfR4GbsR.js";import{i as lt}from"./importExportService-DzuBXo3j.js";const nt={class:"w-full"},it={class:"text-2xl"},ct={class:"font-medium"},dt={key:0,class:"text-xs text-gray-500"},ut={class:"font-mono"},vt={class:"flex items-center gap-2"},mt={class:"flex-1 bg-gray-200 rounded-full h-2"},pt={class:"text-sm font-mono w-16 text-right"},xt={class:"mt-4 pt-4 border-t border-gray-200"},gt={class:"grid grid-cols-3 gap-4"},_t={class:"text-center p-3 bg-gray-50 rounded-lg"},ft={class:"text-lg font-bold mt-1"},yt={class:"text-xs text-gray-500 mt-1"},ht={class:"text-center p-3 bg-gray-50 rounded-lg"},bt={class:"text-lg font-bold mt-1"},kt={class:"text-xs text-gray-500 mt-1"},wt={class:"text-center p-3 bg-gray-50 rounded-lg"},jt={class:"text-lg font-bold mt-1"},$t={class:"text-xs text-gray-500 mt-1"},Vt=J({__name:"ResultadosListaTable",props:{listas:{},cargo:{},totales:{}},emits:["sort"],setup(A,{emit:L}){const b=A,w=L,p=$("votos"),j=$("desc"),C=[{key:"posicion",label:"PosiciÃ³n",align:"center"},{key:"lista",label:"Lista",align:"left"},{key:"votos",label:"Votos",align:"right",sortable:!0},{key:"porcentaje",label:"Porcentaje",align:"right",sortable:!0},{key:"estado",label:"Estado",align:"center"}],E=c=>({1:"ðŸ¥‡",2:"ðŸ¥ˆ",3:"ðŸ¥‰"})[c]||c.toString(),i=(c,o)=>c===1?{variant:"success",text:"1Â° Lugar"}:c===2?{variant:"info",text:"2Â° Lugar"}:c===3?{variant:"warning",text:"3Â° Lugar"}:{variant:"neutral",text:`${c}Â° Lugar`},x=_(()=>[...b.listas].sort((o,a)=>j.value==="desc"?a.votos-o.votos:o.votos-a.votos).map((o,a)=>{const S=a+1;return{posicion:S,lista_id:o.id,nombre:o.nombre,sigla:o.sigla,alianza:o.alianza,votos:o.votos,porcentaje:o.porcentaje,estado:i(S,o.porcentaje)}})),u=_(()=>b.totales||{blancos:{votos:0,porcentaje:0},nulos:{votos:0,porcentaje:0},recurridos:{votos:0,porcentaje:0}}),B=(c,o)=>{p.value=c,j.value=o,w("sort",c,o)};return(c,o)=>(m(),V("div",nt,[d(st,{columns:C,data:x.value,"sort-by":p.value,"sort-order":j.value,onSort:B},{"cell-posicion":n(a=>[t("span",it,r(E(a.value)),1)]),"cell-lista":n(a=>[t("div",null,[t("div",ct,r(a.row.nombre),1),a.row.alianza?(m(),V("div",dt,r(a.row.alianza),1)):I("",!0)])]),"cell-votos":n(a=>[t("span",ut,r(l(f)(a.value)),1)]),"cell-porcentaje":n(a=>[t("div",vt,[t("div",mt,[t("div",{class:"bg-primary h-2 rounded-full transition-all",style:K({width:`${a.value}%`})},null,4)]),t("span",pt,r(l(h)(a.value)),1)])]),"cell-estado":n(a=>[d(at,{variant:a.row.estado.variant,text:a.row.estado.text},null,8,["variant","text"])]),footer:n(()=>[t("div",xt,[t("div",gt,[t("div",_t,[o[0]||(o[0]=t("div",{class:"text-xs text-gray-500 uppercase tracking-wide"},"Blancos",-1)),t("div",ft,r(l(f)(u.value.blancos?.votos||0)),1),t("div",yt,r(l(h)(u.value.blancos?.porcentaje||0)),1)]),t("div",ht,[o[1]||(o[1]=t("div",{class:"text-xs text-gray-500 uppercase tracking-wide"},"Nulos",-1)),t("div",bt,r(l(f)(u.value.nulos?.votos||0)),1),t("div",kt,r(l(h)(u.value.nulos?.porcentaje||0)),1)]),t("div",wt,[o[2]||(o[2]=t("div",{class:"text-xs text-gray-500 uppercase tracking-wide"},"Recurridos",-1)),t("div",jt,r(l(f)(u.value.recurridos?.votos||0)),1),t("div",$t,r(l(h)(u.value.recurridos?.porcentaje||0)),1)])])])]),_:1},8,["data","sort-by","sort-order"])]))}}),Ct=Q(Vt,[["__scopeId","data-v-11d42b7f"]]),Et={class:"min-h-screen flex flex-col"},St={class:"flex-1"},Pt={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6"},Lt={class:"mb-6"},Bt={class:"flex items-center justify-between"},Rt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},At={key:0,class:"flex justify-center items-center py-12"},Tt={class:"text-center py-8"},Dt={class:"mt-2 text-sm text-gray-500"},Mt={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6"},Nt={class:"text-center"},zt={class:"text-3xl font-bold text-primary mt-2"},Ot={class:"text-sm text-gray-600 mt-1"},Ut={class:"text-center"},Ft={class:"text-3xl font-bold text-green-600 mt-2"},It={class:"text-sm text-gray-600 mt-1"},qt={class:"text-center"},Gt={class:"text-3xl font-bold text-blue-600 mt-2"},Ht={class:"text-sm text-gray-600 mt-1"},se={__name:"ResultadosProvincial",setup(A){const L=Y(),b=ot(),w=rt(),{resultadoProvincial:p,loading:j,error:C}=N(b),{provinciasOrdenadas:E}=N(w),i=$(null),x=$(F.DIPUTADOS),u=$(!1),B=_(()=>E.value.map(s=>({value:s.id,label:s.nombre}))),c=_(()=>Object.entries(F).map(([s,e])=>({value:e,label:s.charAt(0)+s.slice(1).toLowerCase()}))),o=_(()=>p.value&&p.value.listas?.length>0),a=_(()=>p.value?.listas||[]),S=_(()=>{const s=p.value;return s?{blancos:{votos:s.votos_blancos||0,porcentaje:s.votos_blancos_porcentaje||0},nulos:{votos:s.votos_nulos||0,porcentaje:s.votos_nulos_porcentaje||0},recurridos:{votos:s.votos_recurridos||0,porcentaje:s.votos_recurridos_porcentaje||0}}:{}}),y=_(()=>{const s=p.value;if(!s)return{mesasEscrutadas:0,mesasTotales:0,mesasEscrutadasPorcentaje:0,participacionPorcentaje:0,votosEmitidos:0,votosValidos:0,votosValidosPorcentaje:0};const e=s.mesas_escrutadas||0,v=s.mesas_totales||0,k=s.votos_emitidos||0,D=s.electores||0,M=s.votos_validos||0;return{mesasEscrutadas:e,mesasTotales:v,mesasEscrutadasPorcentaje:v>0?e/v*100:0,participacionPorcentaje:D>0?k/D*100:0,votosEmitidos:k,votosValidos:M,votosValidosPorcentaje:k>0?M/k*100:0}}),q=()=>{L.push("/")},T=async()=>{if(i.value)try{await b.fetchResultadoProvincial(i.value)}catch(s){console.error("Error loading provincial results:",s)}},G=(s,e)=>{console.log("Sort:",s,e)},H=async()=>{if(!(!i.value||!o.value)){u.value=!0;try{const v=`resultados-provincial-${E.value.find(k=>k.id===i.value)?.nombre?.toLowerCase().replace(/\s+/g,"-")||i.value}-${x.value.toLowerCase()}.csv`;await lt.exportProvincialAndDownload(i.value,v,{cargo:x.value})}catch(s){console.error("Error exporting results:",s)}finally{u.value=!1}}};return z(i,async s=>{s&&await T()}),z(x,async s=>{s&&i.value&&await b.setCargo(s)}),W(async()=>{w.provincias.length===0&&await w.fetchProvincias()}),(s,e)=>(m(),V("div",Et,[d(Z),t("main",St,[t("div",Pt,[t("div",Lt,[t("button",{onClick:q,class:"inline-flex items-center text-primary hover:text-primary-dark transition-colors mb-4"},[...e[2]||(e[2]=[t("svg",{class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1),R(" Volver al Dashboard ",-1)])]),t("div",Bt,[e[5]||(e[5]=t("h1",{class:"text-3xl font-bold text-gray-900"},"Resultados Provinciales",-1)),o.value?(m(),P(O,{key:0,variant:"secondary",loading:u.value,onClick:H},{"icon-left":n(()=>[...e[3]||(e[3]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1)])]),default:n(()=>[e[4]||(e[4]=R(" Exportar CSV ",-1))]),_:1},8,["loading"])):I("",!0)])]),d(g,{class:"mb-6"},{default:n(()=>[t("div",Rt,[d(U,{modelValue:i.value,"onUpdate:modelValue":e[0]||(e[0]=v=>i.value=v),options:B.value,label:"Provincia",placeholder:"Seleccionar provincia...",searchable:""},null,8,["modelValue","options"]),d(U,{modelValue:x.value,"onUpdate:modelValue":e[1]||(e[1]=v=>x.value=v),options:c.value,label:"Cargo",placeholder:"Seleccionar cargo..."},null,8,["modelValue","options"])])]),_:1}),l(j)?(m(),V("div",At,[d(tt,{size:"lg"})])):l(C)?(m(),P(g,{key:1,class:"mb-6"},{default:n(()=>[t("div",Tt,[e[7]||(e[7]=t("svg",{class:"mx-auto h-12 w-12 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),e[8]||(e[8]=t("h3",{class:"mt-4 text-lg font-medium text-gray-900"},"Error al cargar resultados",-1)),t("p",Dt,r(l(C).message),1),d(O,{variant:"primary",class:"mt-4",onClick:T},{default:n(()=>[...e[6]||(e[6]=[R(" Reintentar ",-1)])]),_:1})])]),_:1})):!o.value&&i.value?(m(),P(g,{key:2,class:"mb-6"},{default:n(()=>[...e[9]||(e[9]=[t("div",{class:"text-center py-8"},[t("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})]),t("h3",{class:"mt-4 text-lg font-medium text-gray-900"},"Sin resultados"),t("p",{class:"mt-2 text-sm text-gray-500"},"No hay datos disponibles para los filtros seleccionados.")],-1)])]),_:1})):i.value?(m(),V(X,{key:4},[t("div",Mt,[d(g,null,{default:n(()=>[t("div",Nt,[e[11]||(e[11]=t("div",{class:"text-xs text-gray-500 uppercase tracking-wide"},"Mesas Escrutadas",-1)),t("div",zt,r(l(h)(y.value.mesasEscrutadasPorcentaje)),1),t("div",Ot,r(l(f)(y.value.mesasEscrutadas))+" / "+r(l(f)(y.value.mesasTotales)),1)])]),_:1}),d(g,null,{default:n(()=>[t("div",Ut,[e[12]||(e[12]=t("div",{class:"text-xs text-gray-500 uppercase tracking-wide"},"ParticipaciÃ³n",-1)),t("div",Ft,r(l(h)(y.value.participacionPorcentaje)),1),t("div",It,r(l(f)(y.value.votosEmitidos))+" votos emitidos ",1)])]),_:1}),d(g,null,{default:n(()=>[t("div",qt,[e[13]||(e[13]=t("div",{class:"text-xs text-gray-500 uppercase tracking-wide"},"Votos VÃ¡lidos",-1)),t("div",Gt,r(l(f)(y.value.votosValidos)),1),t("div",Ht,r(l(h)(y.value.votosValidosPorcentaje))+" del total ",1)])]),_:1})]),d(g,{title:"Resultados por Lista"},{default:n(()=>[d(Ct,{listas:a.value,cargo:x.value,totales:S.value,onSort:G},null,8,["listas","cargo","totales"])]),_:1})],64)):(m(),P(g,{key:3,class:"mb-6"},{default:n(()=>[...e[10]||(e[10]=[t("div",{class:"text-center py-8"},[t("svg",{class:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"})]),t("h3",{class:"mt-4 text-lg font-medium text-gray-900"},"Seleccione una provincia"),t("p",{class:"mt-2 text-sm text-gray-500"},"Elija una provincia del filtro superior para ver los resultados.")],-1)])]),_:1}))])]),d(et)]))}};export{se as default};
