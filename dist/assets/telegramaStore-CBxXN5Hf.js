import{l as x,f as c,b as p}from"./index-CBeB2GAs.js";import{b as n}from"./api-DDywFk_F.js";const h=e=>({message:e.message||"Los datos proporcionados no son válidos.",errors:e.errors||{}}),v={getAll(e){return n.get("/telegramas",{params:e}).then(a=>a.data.data)},getById(e){return n.get(`/telegramas/${e}`).then(a=>a.data.data)},getByMesa(e,a={}){const s={mesa_id:e,...a};return n.get("/telegramas",{params:s}).then(i=>i.data.data)},create(e){try{if(e.mesa_id===void 0||e.mesa_id===null||!e.usuario||e.usuario===void 0||e.usuario===null||!Array.isArray(e.votos))throw new Error("Faltan campos requeridos: mesa_id, usuario, votos");if(e.votos.length===0)throw new Error("El array de votos debe contener al menos un elemento");const a={mesa_id:parseInt(e.mesa_id,10),usuario:String(e.usuario),votos:e.votos.map(s=>({lista_id:parseInt(s.lista_id,10),votos_diputados:parseInt(s.votos_diputados,10),votos_senadores:parseInt(s.votos_senadores,10)})),blancos:parseInt(e.blancos,10),nulos:parseInt(e.nulos,10),recurridos:parseInt(e.recurridos,10)};if(a.mesa_id<=0)throw new Error("mesa_id debe ser un entero positivo");if(!a.usuario.trim())throw new Error("usuario no puede estar vacío");if(a.blancos<0)throw new Error("blancos no puede ser negativo");if(a.nulos<0)throw new Error("nulos no puede ser negativo");if(a.recurridos<0)throw new Error("recurridos no puede ser negativo");return n.post("/telegramas",a).then(s=>s.data.data).catch(s=>{throw s.response?.status===422?h(s.response.data):s})}catch(a){throw a}},update(e,a){return n.put(`/telegramas/${e}`,a).then(s=>s.data.data).catch(s=>{throw s.response?.status===422?h(s.response.data):s})},delete(e){return n.delete(`/telegramas/${e}`).then(a=>a.data.data)},validar(e,a=""){return n.put(`/telegramas/${e}/validar`,{observaciones:a}).then(s=>s.data.data)},rechazar(e,a){return n.put(`/telegramas/${e}/rechazar`,{observaciones:a}).then(s=>s.data.data)},getEstadisticas(){return n.get("/telegramas/estadisticas").then(e=>e.data.data)},getByEstado(e){return n.get("/telegramas",{params:{estado:e}}).then(a=>a.data.data)}},z=x("telegrama",()=>{const e=c([]),a=c(null),s=c(null),i=c(!1),d=c(!1),l=c(null),u=c({}),y=p(()=>r=>e.value.filter(t=>t.mesa_id===r)),w=p(()=>{if(!a.value)return 0;let r=0;return a.value.votos&&Array.isArray(a.value.votos)&&a.value.votos.forEach(t=>{r+=parseInt(t.votos_diputados||0,10),r+=parseInt(t.votos_senadores||0,10)}),r+=parseInt(a.value.blancos||0,10),r+=parseInt(a.value.nulos||0,10),r+=parseInt(a.value.recurridos||0,10),r});async function _(){i.value=!0,l.value=null;try{const r=await v.getAll();return e.value=r,r}catch(r){throw l.value=r.message||"Error al cargar telegramas",console.error("Error fetchTelegramas:",r),r}finally{i.value=!1}}async function E(r){d.value=!0,l.value=null,u.value={};try{if(r.mesa_id&&s.value?.electores&&f(r)>s.value.electores)return u.value={general:"La suma de votos no puede ser mayor al número de electores de la mesa"},{success:!1,error:"La suma de votos excede el número de electores"};const t=await v.create(r);return e.value.push(t),{success:!0,data:t}}catch(t){return l.value=t.message||"Error al guardar telegrama",t.errors&&typeof t.errors=="object"&&(u.value=t.errors),{success:!1,error:t}}finally{d.value=!1}}async function I(r,t){d.value=!0,l.value=null,u.value={};try{if(t.mesa_id&&s.value?.electores&&f(t)>s.value.electores)return u.value={general:"La suma de votos no puede ser mayor al número de electores de la mesa"},{success:!1,error:"La suma de votos excede el número de electores"};const o=await v.update(r,t),m=e.value.findIndex(g=>g.id===r);return m!==-1&&(e.value[m]=o),{success:!0,data:o}}catch(o){return l.value=o.message||"Error al actualizar telegrama",o.errors&&typeof o.errors=="object"&&(u.value=o.errors),{success:!1,error:o}}finally{d.value=!1}}async function b(r){i.value=!0,l.value=null;try{const t=await v.delete(r),o=e.value.findIndex(m=>m.id===r);return o!==-1&&e.value.splice(o,1),{success:!0,data:t}}catch(t){return l.value=t.message||"Error al eliminar telegrama",{success:!1,error:t}}finally{i.value=!1}}function A(){a.value=null,s.value=null,l.value=null,u.value={}}function f(r){let t=0;return r.votos&&Array.isArray(r.votos)&&r.votos.forEach(o=>{t+=parseInt(o.votos_diputados||0,10),t+=parseInt(o.votos_senadores||0,10)}),t+=parseInt(r.blancos||0,10),t+=parseInt(r.nulos||0,10),t+=parseInt(r.recurridos||0,10),t}return{telegramas:e,telegramaActual:a,mesaSeleccionada:s,loading:i,saving:d,error:l,validationErrors:u,telegramasPorMesa:y,totalVotos:w,fetchTelegramas:_,guardarTelegrama:E,actualizarTelegrama:I,eliminarTelegrama:b,limpiarFormulario:A}});export{z as u};
