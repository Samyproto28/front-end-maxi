import{c,o as i,a as y,m as L,b as B,e as S,F as b,s as x,p as N,n as w,t as $,i as D,u as E,k as O,_ as U,l as z,f as m}from"./index-CBeB2GAs.js";import{r as H,b as v}from"./api-DDywFk_F.js";function q(e,a){return i(),c("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[y("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m4.5 15.75 7.5-7.5 7.5 7.5"})])}const G={class:"w-full overflow-x-auto"},J={class:"w-full border-collapse text-sm"},Q={class:"bg-gray-50 border-b border-gray-200"},W=["onClick"],X={key:0,class:"inline-flex flex-col"},Y={key:1},Z=["colspan"],_={key:0,class:"mt-4"},ee=L({__name:"AppTable",props:{columns:{},data:{},sortBy:{},sortOrder:{default:"asc"},loading:{type:Boolean,default:!1},emptyMessage:{default:"No hay datos para mostrar"},rowKey:{},skeletonRowCount:{default:5}},emits:["sort"],setup(e,{emit:a}){const n=e,p=a,h=B(()=>Array.from({length:n.skeletonRowCount},(l,g)=>g)),k=l=>{let g="asc";n.sortBy===l&&(g=n.sortOrder==="asc"?"desc":"asc"),p("sort",{key:l,order:g})};return(l,g)=>(i(),c("div",G,[y("table",J,[y("thead",null,[y("tr",Q,[(i(!0),c(b,null,x(e.columns,r=>(i(),c("th",{key:r.key,class:w(["px-4 py-3 text-left font-semibold text-gray-700",[r.sortable&&"cursor-pointer hover:bg-gray-100 select-none",r.align==="center"&&"text-center",r.align==="right"&&"text-right"]]),onClick:u=>r.sortable&&k(r.key)},[y("div",{class:w(["flex items-center gap-1",[r.align==="center"&&"justify-center",r.align==="right"&&"justify-end"]])},[y("span",null,$(r.label),1),r.sortable?(i(),c("span",X,[D(E(q),{class:w(["h-3 w-3 -mb-1",[e.sortBy===r.key&&e.sortOrder==="asc"?"text-primary":"text-gray-400"]])},null,8,["class"]),D(E(H),{class:w(["h-3 w-3 -mt-1",[e.sortBy===r.key&&e.sortOrder==="desc"?"text-primary":"text-gray-400"]])},null,8,["class"])])):S("",!0)],2)],10,W))),128))])]),y("tbody",null,[e.loading?(i(!0),c(b,{key:0},x(h.value,r=>(i(),c("tr",{key:r,class:"border-b border-gray-100"},[(i(!0),c(b,null,x(e.columns,u=>(i(),c("td",{key:u.key,class:"px-4 py-3"},[...g[0]||(g[0]=[y("div",{class:"h-4 bg-gray-200 rounded animate-pulse"},null,-1)])]))),128))]))),128)):!e.data||e.data.length===0?(i(),c("tr",Y,[y("td",{colspan:e.columns.length,class:"px-4 py-8 text-center text-gray-500"},[N(l.$slots,"empty",{},()=>[O($(e.emptyMessage),1)],!0)],8,Z)])):(i(!0),c(b,{key:2},x(e.data,(r,u)=>(i(),c("tr",{key:e.rowKey?r[e.rowKey]:u,class:"border-b border-gray-100 hover:bg-gray-50 transition-colors"},[(i(!0),c(b,null,x(e.columns,d=>(i(),c("td",{key:d.key,class:w(["px-4 py-3",[d.align==="center"&&"text-center",d.align==="right"&&"text-right"]])},[N(l.$slots,`cell-${d.key}`,{row:r,column:d,value:r[d.key],index:u},()=>[O($(r[d.key]??"-"),1)],!0)],2))),128))]))),128))])]),l.$slots.pagination?(i(),c("div",_,[N(l.$slots,"pagination",{},void 0,!0)])):S("",!0)]))}}),re=U(ee,[["__scopeId","data-v-9de47606"]]),T={getProvincial(e,a){return v.get(`/resultados/provincial/${e}`,{params:a}).then(n=>n.data.data)},getNacional(e){return v.get("/resultados/nacional",{params:e}).then(a=>a.data.data)},getByCandidato(e,a){return v.get(`/resultados/candidato/${e}`,{params:a}).then(n=>n.data.data)},getByLista(e,a){return v.get(`/resultados/lista/${e}`,{params:a}).then(n=>n.data.data)},getParticipacion(e){return v.get("/resultados/participacion",{params:e}).then(a=>a.data.data)},getRankingListas(e){return v.get("/resultados/ranking-listas",{params:e}).then(a=>a.data.data)},getResumen(e){return v.get("/resultados/resumen",{params:e}).then(a=>a.data.data)},exportProvincial(e){return v.get(`/export/provincial/${e}`,{responseType:"blob"}).then(a=>a.data)},exportNacional(){return v.get("/export/nacional",{responseType:"blob"}).then(e=>e.data)}},se=z("resultado",()=>{const e=m(null),a=m(null),n=m("DIPUTADOS"),p=m(!1),h=m(null),k=m(null),l=m(null),g=3e4,r=new Map,u=new Map;function d(t){return Date.now()-t<g}function K(t,s){return`${t}-${s}`}const V=B(()=>{const t=e.value||a.value;return t?.listas?[...t.listas].sort((s,o)=>o.votos-s.votos):[]}),M=B(()=>{const t=e.value||a.value;return!t?.votos_emitidos||!t?.electores?0:(t.votos_emitidos/t.electores*100).toFixed(2)});async function C(t){const s=K(t,n.value),o=r.get(s);if(o&&d(o.timestamp))return e.value=o.data,l.value=t,o.data;p.value=!0,h.value=null;try{const f=await T.getProvincial(t,{cargo:n.value});return e.value=f,l.value=t,r.set(s,{data:f,timestamp:Date.now()}),f}catch(f){throw h.value={message:"Error al cargar resultados provinciales",details:f.response?.data?.message||f.message},console.error("Error fetchResultadoProvincial:",f),f}finally{p.value=!1}}async function P(){const t=n.value,s=u.get(t);if(s&&d(s.timestamp))return a.value=s.data,s.data;p.value=!0,h.value=null;try{const o=await T.getNacional({cargo:n.value});return a.value=o,u.set(t,{data:o,timestamp:Date.now()}),o}catch(o){throw h.value={message:"Error al cargar resultados nacionales",details:o.response?.data?.message||o.message},console.error("Error fetchResultadoNacional:",o),o}finally{p.value=!1}}async function j(t){n.value=t,r.clear(),u.clear();const s=[];l.value&&s.push(C(l.value)),a.value&&s.push(P()),s.length>0&&await Promise.all(s)}async function A(){r.clear(),u.clear();const t=[];l.value&&t.push(C(l.value)),a.value!==null&&t.push(P()),t.length>0&&await Promise.all(t)}function F(t=30){R(),k.value=setInterval(async()=>{try{await A()}catch(s){console.error("Error en auto-refresh:",s)}},t*1e3)}function R(){k.value&&(clearInterval(k.value),k.value=null)}function I(){e.value=null,a.value=null,l.value=null,h.value=null,r.clear(),u.clear(),R()}return{resultadoProvincial:e,resultadoNacional:a,cargoSeleccionado:n,loading:p,error:h,listasMasVotadas:V,participacionPorcentaje:M,fetchResultadoProvincial:C,fetchResultadoNacional:P,setCargo:j,refresh:A,startAutoRefresh:F,stopAutoRefresh:R,clearState:I}});export{re as A,se as u};
